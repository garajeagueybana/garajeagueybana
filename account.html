<!DOCTYPE html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mi cuenta</title>
<link rel="stylesheet" href="main_styles.css">
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
</script>
<script type="module" src="firebase-config.js"></script>
<script type="module" src="assets/js/auth.js"></script>
<script type="module">
  import { auth, db, logout } from "./assets/js/auth.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
  import { doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ location.href="login.html"; return; }
    const uref = doc(db,"users",user.uid);
    const usnap = await getDoc(uref);
    const u = usnap.data()||{};
    userName.textContent = user.displayName || `${u.nombre||""} ${u.apellido||""}`.trim();
    userEmail.textContent = user.email;
    userAddr.textContent  = u.direccion || "—";

    const list = document.getElementById("vehicles"); list.innerHTML="";
    const vs = await getDocs(collection(db,"users",user.uid,"vehicles"));
    vs.forEach(d=>{
      const v=d.data();
      const card = document.createElement("div");
      card.className="result-card sedan";
      card.innerHTML = `<b>${v.year} ${v.make} ${v.model}</b><br>Tablilla: <b>${v.plate}</b><br>Plan: <b>${v.tier}</b>`;
      list.appendChild(card);
    });

    document.getElementById("logoutBtn").onclick = logout;
  });
</script>
</head><body>
<nav class="top-nav">
  <div class="nav-left"><img src="Images/Logo_2.webp" alt="Agueybana" class="logo"></div>
  <div class="nav-center nav-buttons">
    <button onclick="location.href='index.html'">Inicio</button>
    <button onclick="location.href='subscripcion.html'">Suscripción</button>
    <button onclick="location.href='nosotros.html'">Sobre nosotros</button>
  </div>
</nav>
<main style="margin-top:12rem">
  <section class="about-us" style="background:#1a1a1a;color:#fff">
    <div class="about-content" style="flex-direction:column;max-width:900px;margin:auto">
      <h2>Hola, <span id="userName">—</span></h2>
      <p>Email: <span id="userEmail">—</span></p>
      <p>Dirección: <span id="userAddr">—</span></p>
      <button class="select-btn" id="logoutBtn" style="width:auto">Cerrar sesión</button>
      <h3 style="margin-top:2rem">Tus vehículos</h3>
      <div id="vehicles"></div>
    </div>
  </section>
</main>
</body></html>
